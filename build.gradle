apply plugin: 'java'
apply plugin: 'application'

repositories {
   mavenLocal()
   jcenter()
   maven {
      url "https://dl.bintray.com/mtschach/Mss"
   }
}

dependencies {
   compile 'org.apache.logging.log4j:log4j-core:latest.release'
   compile 'org.apache.logging.log4j:log4j-api:latest.release'
   compile 'Mss:MssUtils:latest.release'
   compile 'Mss:MssConfigTools:latest.release'
   compile 'Mss:MssNetUtils:latest.release'
   compile group: 'commons-cli', name: 'commons-cli', version: '1.4'
   testCompile 'junit:junit:4.12'
}


mainClassName = 'de.mss.autologout.app.AutoLogout'


jar {
   dependsOn 'serverJar'
   jar.baseName = project.name + 'Full'
   manifest {
      attributes(
         'Class-Path': configurations.compileClasspath.files.collect {"$it.name"}.join(' '),
      'Main-Class': project.mainClassName
      )
   }
   from {
      configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) }
   }
}

task normalJar(type: Jar) {
   manifest {
      attributes(
         'Class-Path': configurations.compileClasspath.files.collect {"$it.name"}.join(' '),
         'Main-Class': project.mainClassName
      )
   }
   from (sourceSets.main.output)
}

task serverJar(type: Jar) {
   jar.baseName = project.name + 'Server'
   manifest {
      attributes(
      'Class-Path': configurations.compileClasspath.files.collect {"$it.name"}.join(' '),
      'Main-Class': 'de.mss.autologout.server.AutoLogoutServer'
      )
   }
   from {
      configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) }
   }
   exclude ('de/mss/autologout/client/**')
}


task clientJar(type: Jar) {
   jar.baseName = project.name + 'Client'
   manifest {
      attributes(
      'Class-Path': configurations.compileClasspath.files.collect {"$it.name"}.join(' '),
      'Main-Class': 'de.mss.autologout.client.AutoLogoutClient'
      )
   }
   from {
      configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) }
   }
   exclude ('de/mss/autologout/server/**')
}
